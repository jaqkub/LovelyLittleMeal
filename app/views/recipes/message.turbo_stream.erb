<%# Remove "What are we cooking today?" message if it exists (only on first message) %>
<% if @chat.messages.count == 2 %>
  <%= turbo_stream.remove "empty-chat-message" %>
<% end %>
<%# Append user message to chat messages %>
<%= turbo_stream.append "chat-messages" do %>
  <%= render "messages/message", message: @user_message %>
<% end %>
<%# Append AI response to chat messages %>
<%= turbo_stream.append "chat-messages" do %>
  <%= render "messages/message", message: @ai_message %>
<% end %>
<%# Update recipe details section with new recipe data %>
<%= turbo_stream.replace "recipe-details" do %>
  <%= render "recipes/details", recipe: @recipe %>
<% end %>
<%# Clear the message input form and reset it %>
<%= turbo_stream.update "message-form" do %>
  <%= form_with url: message_recipe_path(@recipe),
                method: :post,
                class: "d-flex gap-2",
                data: { 
                  turbo_frame: "_top",
                  action: "turbo:submit-start->chat#showLoading turbo:submit-end->chat#hideLoading"
                } do |f| %>
    <%= f.text_field :content,
                     placeholder: "Type...",
                     autofocus: true,
                     autocomplete: "off",
                     id: "message-content",
                     class: "form-control flex-grow-1",
                     value: "" %>
    <%= f.submit "Send", class: "btn btn-primary flex-shrink-0" %>
  <% end %>
<% end %>
