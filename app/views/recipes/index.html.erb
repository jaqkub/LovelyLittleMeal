<% left_content = capture do %>
  <h2 class="mb-3">Your saved recipes</h2>

  <!-- SEARCH AND FILTER -->
  <div class="mb-3">
    <div class="d-flex flex-column flex-md-row gap-2 align-items-stretch align-items-md-center">
      <!-- SEARCH FIELD -->
      <%= form_with url: recipes_path,
                    method: :get,
                    class: "d-flex gap-2 align-items-center flex-grow-1",
                    local: false,
                    data: { turbo_stream: true } do |f| %>
        <%= text_field_tag :query,
                           params[:query],
                           id: "recipe-search-input",
                           class: "form-control flex-grow-1",
                           placeholder: "Search your recipes...",
                           oninput: "this.form.requestSubmit()" %>
        <%= hidden_field_tag :favorites, params[:favorites] if params[:favorites].present? %>
      <% end %>

      <!-- FAVORITES BUTTON - Simple link that toggles -->
      <div id="favorites-button-wrapper">
        <% favorites_active = params[:favorites] == "1" %>
        <% 
          # Build URL: if active, remove favorites param; if inactive, add it
          if favorites_active
            # Toggling off - remove favorites, keep query if present
            favorites_url = params[:query].present? ? recipes_path(query: params[:query]) : recipes_path
          else
            # Toggling on - add favorites, keep query if present
            favorites_url = params[:query].present? ? recipes_path(query: params[:query], favorites: "1") : recipes_path(favorites: "1")
          end
        %>
        <%= link_to favorites_url,
                    id: "favorites-toggle-button",
                    class: "btn favorites-filter-button #{favorites_active ? 'favorites-filter-button-active' : ''}",
                    data: { 
                      turbo_method: :get,
                      turbo_stream: true,
                      turbo_action: "advance"
                    } do %>
          <i class="bi <%= favorites_active ? 'bi-star-fill text-warning' : 'bi-star' %>"></i>
          <span class="ms-1">only</span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- RECIPES LIST (CARDS) -->
  <div id="recipes-list-container" class="d-flex flex-column flex-grow-1" style="min-height: 0;">
    <%= render partial: "recipes/recipes_list", locals: { recipes: @recipes } %>
  </div>
<% end %>

<% right_content = capture do %>
  <div class="d-flex align-items-center justify-content-center flex-grow-1">
    <%= link_to "New Recipe", new_recipe_path,
        class: "btn btn-primary btn-lg",
        data: { turbo_prefetch: false },
        style: "padding: 1rem 2rem; font-size: 1.25rem;" %>
  </div>
<% end %>

<%= render "recipes/two_column_layout",
           left_content: left_content,
           right_content: nil %>
